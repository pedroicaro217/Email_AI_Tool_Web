{% extends 'base.html' %}

{% block title %}Detalhes: {{ campaign.subject }} - {{ super() }}{% endblock %}

{% block content %}
    <style>
        /* Cores de status para evitar l√≥gica dentro do style tag */
        .status-agendado { color: #007bff; } /* Azul */
        .status-cancelado { color: #dc3545; } /* Vermelho */
        
        /* Caixa do Iframe */
        .email-viewer {
            border: 1px solid #ccc; 
            border-radius: 4px; 
            overflow: hidden; 
            background: white;
        }
    </style>

    <div style="display: flex; justify-content: space-between; align-items: center;">
        <a href="{{ url_for('main.history') }}">&larr; Voltar para o Hist√≥rico</a>
        
        {% if campaign.status == 'Agendado' %}
        <div>
            <a href="{{ url_for('main.send_now_campaign', campaign_id=campaign.id) }}" class="btn btn-success" onclick="return confirm('Enviar agora?');">üöÄ Enviar Agora</a>
            <a href="{{ url_for('main.cancel_campaign', campaign_id=campaign.id) }}" class="btn btn-danger" onclick="return confirm('Cancelar agendamento?');">‚ùå Cancelar</a>
        </div>
        {% endif %}
    </div>

    <h1>Detalhes da Campanha #{{ campaign.id }}</h1>
    
    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
        <div style="flex: 1; min-width: 300px;">
            <h2>Informa√ß√µes</h2>
            <ul>
                <li><strong>Assunto:</strong> {{ campaign.subject }}</li>
                <li><strong>Autor:</strong> {{ campaign.user.username if campaign.user else 'Sistema' }}</li>
                <li><strong>Status:</strong> 
                    <span style="font-weight: bold;" class="{% if 'Agendado' in campaign.status %}status-agendado{% elif 'Cancelado' in campaign.status %}status-cancelado{% endif %}">
                        {{ campaign.status }}
                    </span>
                </li>
                {% if campaign.scheduled_at %}
                <li><strong>Agendado para:</strong> {{ campaign.scheduled_at | datetimeformat }}</li>
                {% endif %}
                <li><strong>Criada em:</strong> {{ campaign.created_at | datetimeformat }}</li>
                <li><strong>CTA:</strong> <a href="{{ campaign.cta_url }}" target="_blank">Link</a></li>
            </ul>

            <h2>Destinat√°rios</h2>
            <table style="font-size: 0.9em;">
                <thead>
                    <tr><th>E-mail</th><th>Status</th></tr>
                </thead>
                <tbody>
                    {% for r in campaign.recipients %}
                    <tr>
                        <td>{{ r.email }}</td>
                        <td>{{ r.status }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div style="flex: 1; min-width: 300px;">
            <h2>‚úâÔ∏è Conte√∫do Enviado</h2>
            
            <div class="email-viewer">
                <iframe 
                    srcdoc="<style>body{margin:0 !important; padding:10px !important; font-family: sans-serif;} table{max-width: 100% !important; width: 100% !important; margin: 0 auto;} img{max-width: 100% !important; height: auto;}</style>{{ campaign.generated_html }}" 
                    style="width: 100%; height: 600px; border: none;">
                </iframe>
            </div>

        </div>
    </div>
{% endblock %}